# ðŸ“ˆ Legacy: Visualization and Analysis in PowerBI

This documentation preserves the original instructions for using data generated by this project in **PowerBI Desktop**. Although the current focus of the project is the development of a Web Dashboard, this workflow remains functional for quick analysis.

---

## ðŸ› ï¸ Initial Setup

To manipulate data in PowerBI, follow these steps:

1.  **Import Data**:
    - Open PowerBI Desktop.
    - Go to `Get Data` -> `Text/CSV`.
    - Select `outputs/clientes_afectados_tiempo_real.csv`.
2.  **Transformation (Power Query)**:
    - It is necessary to normalize region names to match standard Chile maps in PowerBI.

### Suggested M Code

In the Advanced Editor of Power Query, you can paste this code to automate cleaning:

```m
let
    Source = Csv.Document(File.Contents("C:\Path\To\Project\outputs\clientes_afectados_tiempo_real.csv"),[Delimiter=",", Columns=9, Encoding=65001, QuoteStyle=QuoteStyle.None]),
    #"Promoted Headers" = Table.PromoteHeaders(Source, [PromoteAllScalars=true]),
    #"Changed Type" = Table.TransformColumnTypes(#"Promoted Headers",{
        {"ID_UNICO", type text},
        {"TIMESTAMP", type datetime},
        {"CLIENTES_AFECTADOS", Int64.Type},
        {"REGION", type text}
    }),
    #"Added Custom" = Table.AddColumn(#"Changed Type", "REGION_CORREGIDA", each "Region of " & [REGION]),

    // Replacements for map compatibility
    Replacements = {
        {"Region of Metropolitana", "Metropolitan Region of Santiago"},
        {"Region of Tarapaca", "TarapacÃ¡ Region"},
        {"Region of Magallanes", "Magallanes and Chilean Antarctica Region"},
        {"Region of Valparaiso", "ValparaÃ­so Region"}
    },
    Result = List.Accumulate(Replacements, #"Added Custom", (table, par) => Table.ReplaceValue(tabla, par{0}, par{1}, Replacer.ReplaceText, {"REGION_CORREGIDA"}))
in
    Result
```

---

## ðŸ“Š Useful DAX Metrics

To enrich your dashboard, you can create the following measures:

### 1. Last Update

Shows the exact time of the last captured report:

```dax
Last Update = MAX('Table'[TIMESTAMP])
```

### 2. Nominal Variation

Compares the current impact with the immediately preceding measurement:

```dax
Affected Variation =
VAR Latest = MAX('Table'[TIMESTAMP])
VAR Previous = CALCULATE(MAX('Table'[TIMESTAMP]), 'Table'[TIMESTAMP] < Latest)
VAR SumLatest = CALCULATE(SUM('Table'[CLIENTES_AFECTADOS]), 'Table'[TIMESTAMP] = Latest)
VAR SumPrevious = CALCULATE(SUM('Table'[CLIENTES_AFECTADOS]), 'Table'[TIMESTAMP] = Previous)
RETURN SumLatest - SumPrevious
```

---

## ðŸ—ºï¸ Chile Map (Shape Map)

If you wish to use the shape map:

1.  Enable `Shape Map Visual` in `Options -> Preview Features`.
2.  Load the `.topojson` or `.json` file found in `maps/poligonos_chile/`.
3.  Use the `REGION_CORREGIDA` column in the **Location** field.

---

_This document is maintained for historical reasons and for users who prefer No-Code solutions for visualization._
